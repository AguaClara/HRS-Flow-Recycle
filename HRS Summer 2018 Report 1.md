#High Rate Sedimentation, Summer 2018
#### Hannah Si and Anna Hong
#### June 29, 2018

##Abstract
Since Spring 2018, the AguaClara High Rate Sedimentation (HRS) team has been investigating the cause behind floc blanket decay in the sedimentation tank, which has been attributed to system failure at high upflow velocities. Along with conducting a small series of experiments, the Summer 2018 HRS team has developed a more robust experimental apparatus and clear set of instructions for setup.

##Methods
###Experimental Apparatus
Below is a picture of the revised lab bench setup of the HRS team followed by a table listing the various components.

<p align=center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/updatedlabbenchsetup.JPG" width = 500>
</p>

Figure 1. Labeled experimental setup for the High Rate Sedimentation lab bench

| Label | Component             |
|:-----:| :-------------------- |
|   1   | Water Pump            |
|   2   | Clay Pump             |
|   3   | Coagulant Pump        |
|   4   | Waste Pump            |
|   5   | Flocculator           |
|   6   | Pressure Sensor       |
|   7   | Influent Turbidimeter |
|   8   | Effluent Turbidimeter |
|   9   | Pressure Attenuator   |
|  10   | Coagulant Stock       |
|  11   | Clay Stock            |
|  12   | Sedimentation Tank    |
|  13   | Waste Tube            |

###Setup Procedures
####Original Configuration

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Original%20Configuration.png" width = 500>
</p>

For detailed instructions and guidelines on preparing the High Rate Sedimentation experimental setup, refer to the [HRS Setup Procedures document](https://github.com/AguaClara/high_rate_sedimentation/blob/master/HRS%20Setup%20Procedures.docx) in our Github repository.

1. Drain the sedimentation tank.

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/DrainSed.png" width = 500>
</p>

2. Clean the flocculator and sedimentation tank.

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Step2.png" width = 500>
</p>

3. Clean out the pressure attenuator.

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/PressureAttentuator.png" width = 500>
</p>

4. Disconnect the coagulant pump from system and check if coagulant is pumping through. Then reconnect it to the system.
   * Make sure the coagulant valve is open. There should be steady droplets of solution.

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/CoagulantStock.png" width = 500>
</p>

5. Run water through the system while bypassing the pressure attenuator.
<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/CleanWaterRun.png" width = 500>
</p>

6. After the water reaches the top of the sed tank, shut off the water pump and drain the sed tank again.
   * Repeat steps 5 and 6 to achieve a more thorough cleaning of the sed tank.

7. Run water only through the system with the pressure attenuator included until effluent turbidity stabilizes near 0 NTU (ideally below 1.0 NTU).

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Step%207.png" width = 500>
</p>

8. Clean out the influent and effluent turbidimeters.

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Step%208.png" width = 500>
</p>

9. Direct the flow to waste instead of the flocculator.

10. Turn the clay stirrer and ProCoDa on.

11. Stabilize influent turbidity to 100 NTU.

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Stabilize%20influent.png" width = 500>
</p>

12. Redirect the flow back to the flocculator and main system. Turn on the coagulant pump to start the experiment.

<p align = center>
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/LastStep.png" width = 500>
</p>

###Experiments and Results

The HRS team has been experimenting with two sedimentation tank designs in an effort to understand the reasons for floc blanket decay in the Spring 2018 and Fall 2017 semesters.

1. **Sedimentation tank A** is the sedimentation tank design used by most AguaClara particle removal research teams, including the HRS team in the Fall 2017 semester. The tube settler is relatively short and the floc weir is placed on the left side of the tube settler.

<p align="center">
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Sedimentation%20Tank%20A.png" width=300>
</p>

Figure 2. Sedimentation Tank A, the sedimentation tank used by most AguaClara research teams, including the Fall 2017 HRS team.

2. **Sedimentation tank B** is the sedimentation tank design used by the Spring 2018 HRS team. The tube settler is relatively long and the floc weir is placed on the right side of the bend in the recirculator.

<p align="center">
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Sedimentation%20Tank%20B.png" width=300>
</p>
<!--Dimensions (cm): 50.5 for short vertical part ,33.5 for slanted part, 97 from bend ,30ยบ is the angle-->
Figure 3. Sedimentation Tank B, the sedimentation tank used by the Spring 2018 HRS research subteam.

####Experiment 1
**Description**: The purpose of the first two experiments is to record initial observations of floc blanket formation and decay using both sedimentation tank designs. For Experiment 1, the HRS apparatus was run at an upflow velocity of 3 mm/s for 9.5 hours using tank A in order to confirm whether this higher rate would lead to floc blanket decay causing system failure.

**Results**: At about two and a half hours into the experiment, an opaque floc blanket has formed in the recirculator. By the end of this shorter experiment, the effluent turbidity did not rise above 2.0 NTU, making this a success. Whether this success was due to the floc weir being in an optimal position or having a more robust system will need to be further investigated. One key observation in the recirculator was more kinetic energy on the right side of the recirculator and in the region just below the bend of the sedimentation tank. This observation may be due to the combined weight of the flocs collected in the tube settler having a greater settling velocity than the upflow velocity of 3 mm/s. Throughout the bulk of the recirculator region, turbulent flow is observed to travel in a sinuous fashion.

From the observations of this experiment, the Summer 2018 HRS team has formulated a hypothesis for floc blanket decay. Due to turbulent flow inside the recirculator, the longer a particle falls, the more likely it is that it will be caught in an upward current of water. Even though particles tend to fall on the tube settler (left) side of the recirculator and rise on the other (right) side, the upward currents inside the tube (perhaps caused by gravity and/or the presence of flocs) weave side to side in turbulent flow, making it possible for falling flocs to collide with and push down rising flocs, and more significantly, rising currents to capture falling flocs. This may be the cause of floc accumulation at the top of the blanket.


####Experiment 2
**Description**: Experiment 2 ran a test with an upflow velocity of 3 mm/s using tank B at a longer time (22.5 hours). This test would help confirm whether the sedimentation tank design plays a factor in floc blanket decay and thus system failure.

**Results**: At the same time when Experiment 1 ended (9.5 hours), the effluent turbidity reached 4.4 NTU. Movement of flocs at this time was slower than that observed in tank A and the floc blanket was not opaque. Since these observations seemed to be characteristic of  earlier stages of floc blanket formation and decay, the experiment was prolonged to 22.5 hours. By the end of this experiment, system failure was observed with a final effluent turbidity of 19.5 NTU. This slower decay may be due to using a more robust system. Nonetheless, this experiment was concluded to be a partial success.

####Experiment 3
**Description**: The next set of experiments were done at a slower upflow velocity in order to simulate and confirm system success observed at AguaClara treatment plants. This experiment tested a 1 mm/s upflow velocity using tank B. For the first 30 minutes, there was an input of excess coagulant because the coagulant pump speed was not reduced from 20 RPM to 6.7 RPM to reflect this lower upflow velocity.

**Results**: The initial effluent turbidity began at 4.6 NTU and increased throughout the duration of the experiment quite rapidly. By the end of 20 hours, the effluent turbidity was higher than influent turbidity at 135 NTU, making this a failure. It was hypothesized that the influx of large amounts of coagulant at the beginning of the experiment caused coagulant to stick to the walls, causing higher shear and decreased diameter. Coagulant particles may be colliding with other coagulant particles instead of clay particles, which only form small flocs. These small particles are more difficult to capture and thus travel upwards to the tube settler and out in the effluent tube.

####Experiment 4
**Description**: To nullify any potential effects from the initial coagulant dosage spike in Experiment 3, this experiment ran at 1 mm/s with the appropriate coagulant pump speed of 6.7 RPM for 8 hours.

**Results**: With a final effluent turbidity of 20 NTU, system failure was observed, disproving that initial excess coagulant was the cause. There was no observable formation of a floc blanket, which means that the smaller flocs that were contaminating the effluent were not being captured and settled out. One key observation was that there seemed to be a gradual increase in floc size within the flocculator as it neared its end. However, the unusually clear sedimentation tank raises the question as to where these bigger flocs ended up going. Since excess coagulant does not seem to be preventing floc blanket formation and that the larger flocs from the flocculator seem to have disappeared, it is hypothesized that the upflow velocity of 1 mm/s is too slow.

####Experiment 5
**Description**: To make sure that the changes that we made to our experimental apparatus is not the cause of system failure, Experiment 1 was rerun but for a longer period of 18 hours.

**Results**: As before, an opaque floc blanket formed with the same density gradient of flocs in the recirculator (higher density of flocs at the top compared to the bottom). However, this experiment ended with a slowly rising effluent turbidity of 26 NTU at 18 hours. There were many flocs settled in the tube settler, which may have reached there before the formation of the floc blanket. It seems that the floc blanket formed later than it had before in Experiment 1, allowing the smaller flocs that are more difficult to capture travel up to the tube settler and out the effluent tube. This much higher effluent turbidity suggests that something has changed since Experiment 1, but whether the design of the system was the change has yet to be determined.

####Experiment 6
**Description**: Since Experiment 1 was a success at an upflow velocity of 3 mm/s, it was predicted that running the same experiment at a lower upflow velocity of 1 mm/s would also be a success. About 2 hours after the start of the experiment, there was still no signs of floc blanket formation. Therefore, the water and coagulant pump speeds were increased to reflect a 2 mm/s upflow velocity to test the hypothesis that upflow velocity was too slow as formulated after Experiment 4.

**Results**: Ending with an effluent turbidity of 46 NTU, this experiment observed system failure. No floc blanket formed throughout the duration of the experiment even with the increased speeds. While it seemed that there could be a speed too slow for this system to succeed, these results suggest that a different factor is causing system failure.

###Future Work
The cause of floc blanket decay and thus system failure has yet to be determined. Future work will focus on verifying pump speed calculations for the water pump. Coagulant dosage will be experimentally adjusted in order to obtain the formation of a floc blanket. More immediately, experiments running at an upflow velocity of 2 mm/s will be tested with a lower coagulant dosage.

###Calculations
We have written code in Python for calculating the system flow rate, water pump speed, coagulant concentration, and coagulant pump speed given an upflow velocity and other parameters.

The calculations in the "Current coagulant dosage calculations" section of our code differ from those of previous HRS teams in that the coagulant pump speed is the quotient of the desired flow rate of coagulant (mL/s) divided by the volume pumped per revolution by the coagulant pump (mL/rev), rather than the desired flow rate of coagulant (mL/s) divided by the flow rate of the coagulant pump (mL/s).

We now also use a similar calculation for water pump speed using values for volume per revolution given by the tubing's specifications, in place of obtaining them experimentally. (Volume per revolution was previously obtained by measuring water output in a set amount of time.)

See the equations below for clarification.

$S$ = pump speed
$Q$ = flow rate
$V$ = volume per revolution

$$S\ \frac{rev}{min} = \frac{Q\ \frac{mL}{min}}{V\ \frac{mL}{rev}}$$


```python
from aguaclara_research.tube_sizing import *
from aide_design.shared.units import unit_registry as u
import numpy

#Tubing ID : volume per revolution
tubing_water = {
  13 : .06*u.mL/u.rev,
  14 : .21*u.mL/u.rev,
  16 : 0.8*u.mL/u.rev,
  17 : 2.8*u.mL/u.rev,
  18 : 3.8*u.mL/u.rev
}

#System parameters, in relation to the sedimentation tank
upflow_velocity = 1 #in millimeters per second
print("CALCULATIONS FOR UPFLOW VELOCITY OF", upflow_velocity, "MM/S \n")

cross_sectional_area = numpy.pi * (0.5*u.inch * 2.54*u.cm/u.inch) ** 2
Q_sys = (upflow_velocity/10*u.cm/u.s * cross_sectional_area).to(u.mL/u.s)
print("System flow rate: ", Q_sys, "\n")

C_clay = 100*u.NTU
C_pacl = 1.4*u.mg/u.L
tubing_clay = "yellow-blue"
tubing_pacl = "yellow-blue"

#Water pump speed
Q_water = Q_water(Q_sys, C_clay, C_pacl, tubing_clay, tubing_pacl)
tubing_water_ID = 17
Q_rev_water = tubing_water[tubing_water_ID]
rpm_water = Q_water/Q_rev_water
print("Water pump speed:", rpm_water, "\n")

#Current coagulant (PACl) concentration and pump speed
print("CURRENT COAGULANT DOSAGE CALCULATIONS")
C_super_stock = 70.28*u.g/u.L
V_stock = 5*u.L
dilution_factor = 0.8*u.mL/u.L
V_super_stock = V_stock * dilution_factor
print("Current volume of coagulant super stock to add: ", V_super_stock)

M_stock = (C_super_stock * V_super_stock).to(u.g)
C_stock = M_stock / V_stock #Note: C_stock= C_super_stock * dilution_factor/1000
print("Current concentration of coagulant stock: ", C_stock)

Q_stock = (Q_sys * C_pacl / C_stock).to(u.mL/u.s)
rpm_pacl = pump_rpm(Q_stock, tubing_pacl)
print("Current coagulant pump speed:", rpm_pacl, "\n")

#Recommended coagulant (PACl) concentration and pump speed
print("RECOMMENDED COAGULANT DOSAGE CALCULATIONS")
rpm_pacl = min_rpm
print("Minimum coagulant pump speed:", rpm_pacl) #defined in tube_sizing.py

C_stock = C_stock_max(Q_sys, C_pacl, tubing_pacl)
print("Maximum concentration of coagulant stock: ", C_stock)

dilution_factor = C_stock / C_super_stock * 1000 * u.mL/u.L
V_super_stock = V_stock * dilution_factor
print("Maximum volume of super stock: ", V_super_stock)
```

###Other Insights
**Spiking influent turbidity**
The influent turbidity seems to spike upwards when we start the coagulant pump, even when the coagulant is not connected to the system or pumping coagulant. It has beens suggested that the vibrations of the pump may be the cause, but we have yet to test this.

**ProCoDa method files**
Since losing our ProCoDa program settings after to a computer restart, we have decided to save snapshots of our ProCoDa setpoints and states after making any significant modifications, such as adding setpoints and variables (e.g. pressure from the pressure sensor), changing setpoint values (e.g. tuning the PID constants), and changing state logic (e.g. periodically flushing the system with a higher water pump speed).

We accomplish this by _saving a new method file_ in our datalog directory with a name corresponding to the experiment and date. The method file behaves as a "snapshot" because ProCoDa continues to read and write its program settings to one particular method file in the `C:\ProCoDa Data` directory, usually `ProCoDa 0.pcm` (0 may be replaced with another number), while leaving the manually uploaded method file untouched.

The past method files stored on the HRS computer and our current method file have been saved to our Github repository.

<p align="center">
  <img src="https://raw.githubusercontent.com/AguaClara/high_rate_sedimentation/master/Images/Config%20Tab_Method%20Files.PNG" height=275>
</p>

Figure 4. Above is the Configuration in ProCoDa. Click the icon pointed to by the red arrow to save a method file snapshot and the icon pointed to by the blue arrow to open a snapshot.

**Sedimentation tank leaks**
If it appears that water is leaking out of the sedimentation tank from where the floc weir was welded to the recirculator or tube settler, you will need to re-weld the connection.

To identify the exact source(s) of the leaking, it is recommended to fill the sedimentation tank with water mixed with dye and dry the exterior of the tank so that any new beads of liquid that emerge are easily detected. You can also dry the exterior, press a dry paper towel against the area of leakage, and match any wet spots on the paper towel to sources of leakage on the tank.
